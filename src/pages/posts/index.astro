---
import BlogLayout from '../../layouts/BlogLayout.astro';

// Carga todos los archivos .md en este directorio (excepto index.astro)
const postFiles = import.meta.glob('./*.md', { eager: true });

const files = Object.values(postFiles) as any[];

const posts = files
  .map((m) => (m && m.frontmatter ? m.frontmatter : null))
  .filter(Boolean)
  .map((fm) => ({
    title: fm.title || 'Sin título',
    excerpt: fm.excerpt || '',
    date: fm.date || '1970-01-01',
    category: fm.category || 'General',
    slug: fm.slug || fm.title?.toLowerCase().replace(/[^a-z0-9]+/g, '-'),
    readTime: fm.readTime || '1 min',
    author: fm.author || 'Autor',
    ogImage: fm.ogImage || '/favicon.svg',
    tags: fm.tags || []
  }))
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
---

<BlogLayout title="Todos los posts" description="Listado de todas las noticias y artículos del blog">
  <div class="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg my-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-8">Todas las noticias</h1>
    <ul class="space-y-6">
      {posts.map((post) => (
        <li>
          <a href={`/posts/${post.slug}`} class="block hover:bg-gray-50 p-4 rounded transition">
            <h2 class="text-xl font-semibold text-blue-700 mb-1">{post.title}</h2>
            <p class="text-gray-600 mb-1">{post.excerpt}</p>
            <span class="text-gray-400 text-sm">{post.date} | {post.category} | {post.readTime}</span>
          </a>
        </li>
      ))}
    </ul>
    <a href="/" class="text-blue-500 hover:underline mt-8 inline-block">← Volver al inicio</a>
  </div>
</BlogLayout>
