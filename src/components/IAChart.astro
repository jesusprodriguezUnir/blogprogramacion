---
const { chartId = 'iaExposureChart', maxWidth = '720px' } = Astro.props;
---

<div class="chart-wrapper" style={`max-width:${maxWidth};margin:24px auto;height:360px;`}>
  <canvas id={chartId} aria-label="Gráfico de barras: porcentaje de tareas automatizables por IA" role="img"></canvas>
</div>

<style>
  .chart-wrapper { position: relative; }
  .chart-wrapper canvas { width: 100%; height: 100%; }
</style>

<script type="module">
  (function(){
    const id = "${chartId}";
    if (typeof window === 'undefined') return;
    const canvas = document.getElementById(id);
    if (!canvas) return;

    import('https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js')
      .then(({ Chart }) => {
        try {
          const ctx = canvas.getContext('2d');
          const data = {
            labels: ['Trabajos manuales', 'Administración', 'Ventas', 'STEM', 'Servicios baja cualificación'],
            datasets: [{
              label: 'Porcentaje de tareas automatizables (%)',
              data: [15, 67, 60, 30, 55],
              backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#8b5cf6', '#6b7280'],
              borderColor: ['#0b815a', '#1e40af', '#b45309', '#6d28d9', '#374151'],
              borderWidth: 1
            }]
          };

          const options = {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true, max: 100, ticks: { stepSize: 10 } } },
            plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } }
          };

          // eslint-disable-next-line no-new
          new Chart(ctx, { type: 'bar', data, options });
        } catch (e) {
          console.warn('Chart render failed', e);
        }
      })
      .catch(err => console.warn('Failed to load Chart.js', err));
  })();
</script>
